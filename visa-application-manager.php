<?php
/**
 * Plugin Name: Visa Application Manager
 * Description: A custom dashboard for user applications.
 * Version: 1.0
 * Author: Your Name
 */

// Exit if accessed directly.
if (!defined('ABSPATH')) {
    exit;
}


// Enqueue styles and scripts
function visa_dashboard_enqueue_scripts() {
    wp_enqueue_style('visa-dashboard-style', plugin_dir_url(__FILE__) . 'css/style.css');
    wp_enqueue_style('visa-dashboard-global-style', plugin_dir_url(__FILE__) . 'css/globalstyle.css');
    wp_enqueue_script('jquery');
    // Enqueue your custom script that contains the AJAX code
    wp_enqueue_script('custom-ajax-script', plugin_dir_url(__FILE__) . 'js/custom-script.js', array('jquery'), null, true);
    wp_localize_script('custom-ajax-script', 'ajax_object', array('ajax_url' => admin_url('admin-ajax.php')));
}

add_action('wp_enqueue_scripts', 'visa_dashboard_enqueue_scripts');

// Create a shortcode for the dashboard
function visa_dashboard_shortcode($atts) {
    $atts = shortcode_atts(array(
        'application_form_id' => '0', // Default value
        'form_submit_page' => 'form'
    ), $atts);
    // if ( is_user_logged_in() ) {
        global $wpdb;

        $user_id = get_current_user_id();

        // Check if the user_id from GET is a co-traveler of the current user
        $co_traveler_id = isset($_GET['user_id']) ? intval($_GET['user_id']) : '';
        
        // Perform a database query to check the co-traveler relationship
        $query = $wpdb->prepare(
            "SELECT COUNT(*) FROM wp_co_travelers_info WHERE co_traveler_id = %d AND user_id = %d",
            $co_traveler_id,
            $user_id
        );
            
        $count = $wpdb->get_var($query);

        
        if (isset($_GET['user_id'])) {
            if ( current_user_can( 'administrator' ) ) {
                $user_id = intval($_GET['user_id']); // Sanitize to ensure it's an integer
            }
            elseif($count > 0){
                $user_id = intval($_GET['user_id']); // Sanitize to ensure it's an integer
            }  
        }
        $current_user_id = $user_id;
        $total_applied_visa = $wpdb->get_var( $wpdb->prepare(
            "SELECT COUNT(*) FROM wp_wpforms_entries WHERE user_id = %d AND form_id = %d",
            $current_user_id , intval($atts['application_form_id'])
        ) );
        $entries_unpaid_visa = $wpdb->get_results( $wpdb->prepare(
            "SELECT entry_id, date_modified FROM wp_wpforms_entries WHERE user_id = %d AND form_id = %d AND type = ''",
            $current_user_id, 
            intval($atts['application_form_id'])
        ) );
        // Fetch all relevant entries for the user
    $fields_jsons = $wpdb->get_results( $wpdb->prepare(
        "SELECT fields 
        FROM wp_wpforms_entries 
        WHERE user_id = %d AND form_id = 17 AND type = 'payment';",
        $current_user_id
    ) );

    $total_amount = 0;

    // Loop through each entry and accumulate the total amount
    foreach ( $fields_jsons as $entry ) {
        $fields = json_decode( $entry->fields, true );
    
        // Loop through each field in the entry
        foreach ( $fields as $key => $field ) {
            // Check if the field type is 'payment-checkbox'
            if ( isset($field['type']) && $field['type'] === 'payment-checkbox' ) {
                // Extract the amount
                $amount = isset($field['amount_raw']) ? $field['amount_raw'] : 0; // This is the amount as an integer
                $total_amount += $amount; // Add to total
            }
        }
    }
        
    // echo intval($atts['application_form_id']);
    ob_start(); ?>
    <?php include 'head.php'; ?>
<body>
    <div id="__next">
        <main role="main" id="__main" class="__variable_c389b4 font-noto-sans">
            <style>
                #nprogress {
                    pointer-events: none;
                }

                #nprogress .bar {
                    background: #2a2e6a;
                    position: fixed;
                    z-index: 9999;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 3px;
                }

                #nprogress .peg {
                    display: block;
                    position: absolute;
                    right: 0px;
                    width: 100px;
                    height: 100%;
                    box-shadow: 0 0 10px #2a2e6a, 0 0 5px #2a2e6a;
                    opacity: 1;
                    -webkit-transform: rotate(3deg) translate(0px, -4px);
                    -ms-transform: rotate(3deg) translate(0px, -4px);
                    transform: rotate(3deg) translate(0px, -4px);
                }

                #nprogress .spinner {
                    display: block;
                    position: fixed;
                    z-index: 1031;
                    top: 15px;
                    right: 15px;
                }

                #nprogress .spinner-icon {
                    width: 18px;
                    height: 18px;
                    box-sizing: border-box;
                    border: solid 2px transparent;
                    border-top-color: #2a2e6a;
                    border-left-color: #2a2e6a;
                    border-radius: 50%;
                    -webkit-animation: nprogresss-spinner 400ms linear infinite;
                    animation: nprogress-spinner 400ms linear infinite;
                }

                .nprogress-custom-parent {
                    overflow: hidden;
                    position: relative;
                }

                .nprogress-custom-parent #nprogress .spinner,
                .nprogress-custom-parent #nprogress .bar {
                    position: absolute;
                }

                @-webkit-keyframes nprogress-spinner {
                    0% {
                        -webkit-transform: rotate(0deg);
                    }

                    100% {
                        -webkit-transform: rotate(360deg);
                    }
                }

                @keyframes nprogress-spinner {
                    0% {
                        transform: rotate(0deg);
                    }

                    100% {
                        transform: rotate(360deg);
                    }
                }
            </style>
            <div class="ant-layout ant-layout-has-sider css-1588u1j" style="min-height:100vh">
                <?php include 'header.php'; 
                include 'sidebar.php';
                ?>
                <!-- main content -->
                <div class="ant-layout flex flex-col justify-between css-1588u1j"
                    style="background: rgb(243, 243, 252); padding: 0px 14px 14px;">
                    <main class="ant-layout-content css-1588u1j"
                        style="border-radius: 5px; min-height: 280px; margin-top: 110px; margin-left: 0px; margin-right: 14px; background: rgb(255, 255, 255);">
                        <div class="overview_page mb-4">
                            <div class="grid grid-cols-1 gap-[20px] md:grid-cols-2 xl:grid-cols-3">
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M22.2919 19.1606C23.4124 18.4303 24.2272 17.2686 24.4988 15.913H22.8812C22.8086 17.1038 22.6064 18.2216 22.2919 19.1606ZM18.7228 18.6861C19.0788 19.6674 19.4433 19.9485 19.5353 19.9776C19.6272 19.9485 19.9917 19.6675 20.3477 18.6861C20.6283 17.9127 20.8129 16.952 20.885 15.913H18.1855C18.2577 16.952 18.4422 17.9127 18.7228 18.6861Z"
                                                    fill="#14B082"></path>
                                                <path
                                                    d="M26.3655 0H9.63509V34H26.3655C28.2416 34 29.768 32.4736 29.768 30.5975V3.40253C29.768 1.52635 28.2417 0 26.3655 0ZM25.5936 26.1387H13.4774V24.1465H25.5936V26.1387ZM19.5459 21.9709H19.5251C15.6401 21.9653 12.4813 18.803 12.4813 14.9168C12.4813 11.0306 15.6401 7.86829 19.5251 7.86265H19.5459C23.4308 7.86829 26.5896 11.0306 26.5896 14.9168C26.5897 18.803 23.4309 21.9653 19.5459 21.9709ZM4.23047 0H7.64296V34H4.23047V0Z"
                                                    fill="#14B082"></path>
                                                <path
                                                    d="M16.7791 19.161C16.4646 18.222 16.2624 17.1042 16.1899 15.9134H14.5723C14.8439 17.269 15.6587 18.4307 16.7791 19.161ZM24.4994 13.9212C24.2278 12.5656 23.413 11.4038 22.2925 10.6734C22.607 11.6125 22.8092 12.7303 22.8818 13.9212H24.4994ZM20.3483 11.148C19.9923 10.1666 19.6278 9.8856 19.5358 9.85645C19.4438 9.8856 19.0793 10.1666 18.7233 11.148C18.4428 11.9214 18.2582 12.8821 18.1861 13.9212H20.8855C20.8135 12.8821 20.6289 11.9214 20.3483 11.148ZM16.7791 10.6734C15.6587 11.4038 14.8439 12.5656 14.5723 13.9212H16.1899C16.2624 12.7303 16.4646 11.6126 16.7791 10.6734Z"
                                                    fill="#14B082"></path>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Applied Visa</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-[40px] font-semibold text-[var(--color-chinese-black)]"><?php echo  $total_applied_visa; ?></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M31.4351 21.3775C30.8895 21.3297 30.3487 21.1294 30.1336 20.5647C29.8945 20.0356 30.141 19.5064 30.4842 19.0931C30.6383 18.8806 30.6117 18.5938 30.4311 18.4078L28.3433 16.32C28.1573 16.1394 27.8704 16.1128 27.6579 16.2669L27.3498 16.4847C26.6762 17.0053 25.5478 16.5569 25.4373 15.6931L25.3736 15.3159C25.3534 15.1926 25.2899 15.0804 25.1944 14.9996C25.099 14.9188 24.978 14.8746 24.8529 14.875H21.8987C21.6383 14.875 21.4205 15.0609 21.378 15.3159L21.3143 15.6931C21.2064 16.541 20.0898 17.0159 19.4018 16.4847L19.0937 16.2669C18.8812 16.1128 18.5943 16.1394 18.4083 16.32L16.32 18.4078C16.1394 18.5938 16.1128 18.8806 16.2669 19.0931L16.4847 19.4013C17.0053 20.0749 16.5569 21.2027 15.6931 21.3138L15.3159 21.3775C15.1926 21.3977 15.0804 21.4612 14.9996 21.5566C14.9188 21.652 14.8746 21.7731 14.875 21.8981V24.8519C14.875 25.1122 15.0609 25.33 15.3159 25.3725L15.6931 25.4363C16.1075 25.5053 16.4475 25.7763 16.6175 26.1853C16.7769 26.5731 16.7291 27.0088 16.4847 27.3488C16.2584 27.6425 15.9906 27.999 16.32 28.3422L18.4078 30.43C18.5938 30.6106 18.8806 30.6372 19.0931 30.4831C19.5128 30.133 20.0356 29.895 20.5859 30.1431C21.1315 30.345 21.3292 30.898 21.3775 31.4341C21.42 31.6891 21.6378 31.875 21.8981 31.875H24.8524C25.1127 31.875 25.3305 31.6891 25.373 31.4341L25.4368 31.0569C25.5446 30.209 26.6613 29.7341 27.3493 30.2653C27.6431 30.4916 27.9995 30.7594 28.3427 30.43L30.4305 28.3422C30.6112 28.1563 30.6377 27.8694 30.4837 27.6569C30.1341 27.2372 29.8961 26.7144 30.1437 26.1641C30.3461 25.6185 30.8991 25.4214 31.4346 25.3725C31.5581 25.3524 31.6704 25.289 31.7513 25.1935C31.8322 25.0981 31.8764 24.977 31.8761 24.8519V21.8981C31.8761 21.6378 31.6901 21.42 31.4351 21.3775ZM23.3755 28.4219C20.6736 28.4761 18.2718 26.0828 18.3287 23.375C18.3048 18.9284 23.7984 16.643 26.9402 19.7997C30.1118 22.9463 27.829 28.4431 23.3755 28.4219Z"
                                                    fill="#F23936"></path>
                                                <path
                                                    d="M15.5652 29.0856C14.8826 28.3844 15.0117 27.4223 15.6183 26.7375C15.6608 26.6791 15.6502 26.6259 15.6343 26.5887C15.5971 26.4984 15.544 26.4878 15.5174 26.4825C14.593 26.423 13.8142 25.8296 13.8121 24.8516V21.8978C13.8121 21.1169 14.3699 20.4581 15.1402 20.3306C15.2348 20.2987 15.596 20.3041 15.6237 20.1819C15.6662 20.0809 15.6343 20.0384 15.6237 20.0225L15.4005 19.7037C14.949 19.0875 15.0127 18.2269 15.5599 17.6691L17.6583 15.5706C18.3405 14.8832 19.3318 15.0107 20.0118 15.6184C20.1042 15.6987 20.2747 15.5892 20.2668 15.5175C20.3242 14.5958 20.9218 13.8132 21.8977 13.8122H23.5074C22.4821 12.3459 21.1274 11.1134 19.539 10.2581C19.3144 10.6884 18.9764 11.049 18.5616 11.3009C18.1467 11.5528 17.6709 11.6864 17.1855 11.6872H11.3896C10.4068 11.6872 9.48241 11.14 9.03616 10.2422C3.80706 13.0419 1.41113 19.8153 3.78581 25.2712C0.773626 27.1466 2.12831 31.8853 5.68769 31.8747H18.3484C17.9181 31.4391 16.0359 29.5622 15.5652 29.0856Z"
                                                    fill="#F23936"></path>
                                                <path
                                                    d="M8.66544 6.93823C9.08512 7.54385 9.57387 7.98479 9.98825 8.2876C9.40175 9.29485 10.2268 10.6559 11.3854 10.6251H17.1867C18.3432 10.657 19.1709 9.29645 18.5839 8.2876C19.6363 7.56882 20.6048 6.11001 20.8364 4.73885C21.1302 3.43038 20.0283 2.09163 18.6901 2.12563H9.882C8.54378 2.0927 7.44037 3.42985 7.73575 4.73938C7.90044 5.54688 8.20856 6.28479 8.66544 6.93823Z"
                                                    fill="#F23936"></path>
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M19.8518 25.2345C18.4249 22.6792 20.4415 19.3211 23.374 19.3907C25.5075 19.3376 27.4099 21.2528 27.3584 23.3751C27.3302 27.5125 21.8057 28.8767 19.8518 25.2345ZM22.2988 25.0123C22.299 25.2266 22.312 25.3977 22.3379 25.5255C22.3692 25.6541 22.4084 25.7544 22.4553 25.8264C22.5075 25.8983 22.5623 25.9626 22.6196 26.0192C22.7083 26.1015 22.8257 26.1683 22.9718 26.2197C23.1231 26.2712 23.3083 26.2969 23.5274 26.2969C23.7674 26.2969 24.0125 26.2609 24.263 26.1889C24.5186 26.1118 24.7533 26.0012 24.9672 25.8572C25.1811 25.7132 25.3533 25.5332 25.4837 25.3173C25.6141 25.1013 25.6793 24.8545 25.6793 24.5768C25.6793 24.3376 25.6168 24.1499 25.4918 24.0134C25.4636 23.9826 25.4322 23.9544 25.3976 23.9289C25.2098 23.79 24.962 23.7206 24.6542 23.7206C24.529 23.7206 24.4064 23.7257 24.2864 23.736C24.1717 23.7463 24.0673 23.7643 23.9734 23.79L24.0848 24.49L24.0986 24.5768C24.1717 24.5614 24.2551 24.5536 24.349 24.5536C24.469 24.5536 24.5499 24.5742 24.5916 24.6154C24.6333 24.6565 24.6542 24.7002 24.6542 24.7465C24.6542 24.839 24.6255 24.929 24.5681 25.0164C24.5108 25.1039 24.4351 25.181 24.3412 25.2479C24.2473 25.3096 24.143 25.361 24.0282 25.4021C23.9134 25.4381 23.796 25.4561 23.6761 25.4561C23.53 25.4561 23.4361 25.4227 23.3943 25.3558C23.3526 25.2838 23.3317 25.1759 23.3317 25.0319V24.5439V23.76V23.2732H25.8984V22.4247H25.2438H23.7525H23.3317V22.3021V21.9234C23.3317 21.735 23.3217 21.5717 23.3017 21.4336C23.2878 21.338 23.2691 21.2544 23.2457 21.1829C23.1883 21.008 23.1074 20.8718 23.0031 20.7741C22.9144 20.6867 22.8048 20.6224 22.6744 20.5812C22.544 20.5401 22.3927 20.5195 22.2206 20.5195C22.0119 20.5195 21.8267 20.5375 21.665 20.5735C21.5032 20.6044 21.3206 20.6558 21.1172 20.7278L21.4145 21.4683C21.4928 21.4374 21.5684 21.4143 21.6415 21.3989C21.6896 21.3894 21.7357 21.3828 21.7798 21.3792C21.8075 21.3769 21.8344 21.3757 21.8606 21.3757C21.9858 21.3757 22.0797 21.3989 22.1423 21.4451C22.2049 21.4863 22.2466 21.5506 22.2675 21.638C22.2884 21.7254 22.2988 21.8334 22.2988 21.9619V22.1502V22.4247H21.646H21.6415V22.4804V23.2732H22.2988V24.1892V24.5439V24.7054V25.0087C22.2988 25.0099 22.2988 25.0111 22.2988 25.0123Z"
                                                    fill="#F23936"></path>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Amount Paid</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-[30px] font-semibold text-[#0C0D1D]">৳ <?php echo $total_amount; ?></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M24.951 29.9452C24.7739 30.1223 24.5337 30.2219 24.2833 30.2219H5.1951C4.47719 30.2248 3.77839 29.9908 3.20704 29.5561C3.09089 29.4707 2.98191 29.3759 2.88121 29.2728C2.98911 29.8069 3.27848 30.2873 3.70022 30.6325C4.12197 30.9776 4.65012 31.1663 5.1951 31.1664H28.8062C29.4324 31.1664 30.033 30.9176 30.4758 30.4748C30.9186 30.032 31.1673 29.4315 31.1673 28.8053V23.7289L24.951 29.9452ZM28.8062 4.72192H5.1951C4.56889 4.72192 3.96833 4.97068 3.52554 5.41348C3.08274 5.85627 2.83398 6.45683 2.83398 7.08303V11.8053H31.1673V7.08303C31.1673 6.45683 30.9186 5.85627 30.4758 5.41348C30.033 4.97068 29.4324 4.72192 28.8062 4.72192ZM30.2229 10.8608H3.77843V7.08303C3.77955 6.70766 3.92917 6.34797 4.1946 6.08254C4.46003 5.8171 4.81972 5.66749 5.1951 5.66637H28.8062C29.1816 5.66749 29.5413 5.8171 29.8067 6.08254C30.0721 6.34797 30.2218 6.70766 30.2229 7.08303V10.8608Z"
                                                    fill="#FABB18"></path>
                                                <path
                                                    d="M17.0015 2.83301C16.6258 2.83301 16.2655 2.98226 15.9998 3.24794C15.7341 3.51362 15.5849 3.87395 15.5849 4.24967V7.08301C15.5849 7.45873 15.7341 7.81907 15.9998 8.08474C16.2655 8.35042 16.6258 8.49968 17.0015 8.49968C17.3772 8.49968 17.7376 8.35042 18.0033 8.08474C18.2689 7.81907 18.4182 7.45873 18.4182 7.08301V4.24967C18.4182 3.87395 18.2689 3.51362 18.0033 3.24794C17.7376 2.98226 17.3772 2.83301 17.0015 2.83301ZM9.44596 2.83301C9.07024 2.83301 8.70991 2.98226 8.44423 3.24794C8.17855 3.51362 8.0293 3.87395 8.0293 4.24967V7.08301C8.0293 7.45873 8.17855 7.81907 8.44423 8.08474C8.70991 8.35042 9.07024 8.49968 9.44596 8.49968C9.82169 8.49968 10.182 8.35042 10.4477 8.08474C10.7134 7.81907 10.8626 7.45873 10.8626 7.08301V4.24967C10.8626 3.87395 10.7134 3.51362 10.4477 3.24794C10.182 2.98226 9.82169 2.83301 9.44596 2.83301ZM24.5571 2.83301C24.1813 2.83301 23.821 2.98226 23.5553 3.24794C23.2897 3.51362 23.1404 3.87395 23.1404 4.24967V7.08301C23.1404 7.45873 23.2897 7.81907 23.5553 8.08474C23.821 8.35042 24.1813 8.49968 24.5571 8.49968C24.9328 8.49968 25.2931 8.35042 25.5588 8.08474C25.8245 7.81907 25.9737 7.45873 25.9737 7.08301V4.24967C25.9737 3.87395 25.8245 3.51362 25.5588 3.24794C25.2931 2.98226 24.9328 2.83301 24.5571 2.83301ZM25.9737 22.6663C25.5984 22.6675 25.2387 22.8171 24.9732 23.0825C24.7078 23.3479 24.5582 23.7076 24.5571 24.083V29.0036L30.2237 23.3369L30.8943 22.6663H25.9737ZM21.2515 18.1802H19.1265C19.0013 18.1802 18.8812 18.1305 18.7926 18.0419C18.704 17.9534 18.6543 17.8333 18.6543 17.708V15.583C18.6543 15.3325 18.5548 15.0923 18.3777 14.9152C18.2006 14.7381 17.9603 14.6386 17.7099 14.6386H16.2932C16.0427 14.6386 15.8025 14.7381 15.6254 14.9152C15.4482 15.0923 15.3487 15.3325 15.3487 15.583V17.708C15.3487 17.8333 15.299 17.9534 15.2104 18.0419C15.1219 18.1305 15.0018 18.1802 14.8765 18.1802H12.7515C12.501 18.1802 12.2608 18.2797 12.0837 18.4569C11.9066 18.634 11.8071 18.8742 11.8071 19.1247V20.5413C11.8071 20.7918 11.9066 21.0321 12.0837 21.2092C12.2608 21.3863 12.501 21.4858 12.7515 21.4858H14.8765C15.0018 21.4858 15.1219 21.5355 15.2104 21.6241C15.299 21.7127 15.3487 21.8328 15.3487 21.958V24.083C15.3487 24.3335 15.4482 24.5737 15.6254 24.7508C15.8025 24.928 16.0427 25.0275 16.2932 25.0275H17.7099C17.9603 25.0275 18.2006 24.928 18.3777 24.7508C18.5548 24.5737 18.6543 24.3335 18.6543 24.083V21.958C18.6543 21.8328 18.704 21.7127 18.7926 21.6241C18.8812 21.5355 19.0013 21.4858 19.1265 21.4858H21.2515C21.502 21.4858 21.7422 21.3863 21.9193 21.2092C22.0965 21.0321 22.196 20.7918 22.196 20.5413V19.1247C22.196 18.8742 22.0965 18.634 21.9193 18.4569C21.7422 18.2797 21.502 18.1802 21.2515 18.1802Z"
                                                    fill="#FABB18"></path>
                                                <path
                                                    d="M28.8062 4.72192H5.1951C4.56889 4.72192 3.96833 4.97068 3.52554 5.41348C3.08274 5.85627 2.83398 6.45683 2.83398 7.08303V26.9164C2.83435 27.2829 2.91985 27.6442 3.08375 27.972C3.24765 28.2998 3.48546 28.5851 3.77843 28.8053C4.18617 29.1136 4.68389 29.2795 5.1951 29.2775H23.6118V24.083C23.6118 23.4568 23.8605 22.8563 24.3033 22.4135C24.7461 21.9707 25.3467 21.7219 25.9729 21.7219H31.1673V7.08303C31.1673 6.45683 30.9186 5.85627 30.4758 5.41348C30.033 4.97068 29.4324 4.72192 28.8062 4.72192ZM23.1395 20.5414C23.1395 21.0423 22.9405 21.5228 22.5863 21.877C22.2321 22.2312 21.7516 22.4303 21.2507 22.4303H19.5979V24.083C19.5979 24.584 19.3989 25.0644 19.0446 25.4187C18.6904 25.7729 18.2099 25.9719 17.709 25.9719H16.2923C15.7914 25.9719 15.3109 25.7729 14.9567 25.4187C14.6024 25.0644 14.4034 24.584 14.4034 24.083V22.4303H12.7507C12.2497 22.4303 11.7692 22.2312 11.415 21.877C11.0608 21.5228 10.8618 21.0423 10.8618 20.5414V19.1247C10.8618 18.6237 11.0608 18.1433 11.415 17.7891C11.7692 17.4348 12.2497 17.2358 12.7507 17.2358H14.4034V15.583C14.4034 15.0821 14.6024 14.6016 14.9567 14.2474C15.3109 13.8932 15.7914 13.6941 16.2923 13.6941H17.709C18.2099 13.6941 18.6904 13.8932 19.0446 14.2474C19.3989 14.6016 19.5979 15.0821 19.5979 15.583V17.2358H21.2507C21.7516 17.2358 22.2321 17.4348 22.5863 17.7891C22.9405 18.1433 23.1395 18.6237 23.1395 19.1247V20.5414ZM30.2229 10.3886H3.77843V7.08303C3.77955 6.70766 3.92917 6.34797 4.1946 6.08254C4.46003 5.8171 4.81972 5.66749 5.1951 5.66637H28.8062C29.1816 5.66749 29.5413 5.8171 29.8067 6.08254C30.0721 6.34797 30.2218 6.70766 30.2229 7.08303V10.3886Z"
                                                    fill="#FABB18"></path>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Appointment Take</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-[40px] font-semibold text-[var(--color-chinese-black)]"><?php echo 0; ?></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M10.4194 2.4781C12.487 1.54144 14.7314 1.05874 17.0013 1.06252C21.2269 1.06518 25.2786 2.74682 28.2667 5.73454C31.2548 8.72226 32.9349 12.7738 32.9381 16.9993C32.9391 20.3927 31.8518 23.6969 29.8359 26.4265L31.7173 28.3099C31.7921 28.3842 31.8431 28.4791 31.8639 28.5824C31.8848 28.6858 31.8744 28.793 31.8341 28.8904C31.7939 28.9879 31.7257 29.0712 31.638 29.1298C31.5503 29.1884 31.4473 29.2196 31.3418 29.2195H25.4988C25.2057 29.2195 24.9687 28.9806 24.9687 28.6854V22.8424C24.969 22.7373 25.0004 22.6348 25.0589 22.5475C25.1174 22.4603 25.2004 22.3924 25.2974 22.3522C25.3944 22.3121 25.5012 22.3015 25.6042 22.3219C25.7072 22.3423 25.8019 22.3928 25.8763 22.4669L27.5509 24.1415C28.8501 22.2255 29.6027 19.9918 29.7279 17.6803C29.8531 15.3688 29.3461 13.0668 28.2614 11.0218C27.1768 8.97669 25.5554 7.2658 23.5715 6.0729C21.5876 4.88001 19.3162 4.25018 17.0013 4.25109C15.2124 4.24724 13.443 4.62153 11.8089 5.34942C11.6836 5.40595 11.5413 5.41181 11.4118 5.36577C11.2823 5.31973 11.1756 5.22537 11.1141 5.10244L10.1644 3.20095C10.1323 3.13699 10.1134 3.06721 10.1089 2.9958C10.1044 2.92438 10.1144 2.85279 10.1382 2.7853C10.162 2.71782 10.1992 2.65583 10.2475 2.60305C10.2958 2.55026 10.3543 2.50777 10.4194 2.4781ZM2.35921 4.8685C2.44674 4.81016 2.54959 4.77908 2.65478 4.77917H8.49781C8.56785 4.77917 8.63721 4.793 8.7019 4.81986C8.76658 4.84673 8.82533 4.8861 8.87477 4.93573C8.9242 4.98535 8.96336 5.04424 8.98998 5.10903C9.0166 5.17382 9.03017 5.24323 9.0299 5.31327V11.1563C9.02883 11.2605 8.99719 11.3621 8.9389 11.4485C8.88062 11.5348 8.79825 11.6022 8.70202 11.6422C8.6058 11.6822 8.49995 11.693 8.39761 11.6734C8.29527 11.6538 8.20095 11.6045 8.12634 11.5318L6.44572 9.85518C5.14515 11.7716 4.39158 14.0063 4.26607 16.3189C4.14055 18.6316 4.64783 20.9347 5.73336 22.9806C6.81888 25.0266 8.44159 26.7379 10.427 27.9305C12.4123 29.1232 14.6853 29.7521 17.0013 29.7496C18.7905 29.7521 20.56 29.3764 22.1938 28.6472C22.3184 28.5925 22.4592 28.5876 22.5873 28.6336C22.7154 28.6795 22.8211 28.7728 22.8825 28.8942L23.8363 30.7957C23.868 30.8596 23.8866 30.9292 23.891 31.0004C23.8953 31.0716 23.8853 31.1429 23.8615 31.2102C23.8377 31.2774 23.8006 31.3392 23.7525 31.3918C23.7043 31.4444 23.6461 31.4869 23.5813 31.5165C21.1534 32.6147 18.489 33.087 15.8316 32.8901C13.1741 32.6933 10.6084 31.8338 8.36876 30.3899C6.12912 28.9461 4.287 26.964 3.01069 24.6249C1.73438 22.2857 1.06459 19.664 1.0625 16.9993C1.06062 13.6056 2.14724 10.3007 4.16272 7.57017L2.27729 5.68675C2.20306 5.61222 2.15259 5.51736 2.13225 5.41416C2.11191 5.31096 2.12262 5.20404 2.16301 5.10692C2.20341 5.0098 2.27168 4.92683 2.35921 4.8685ZM8.50182 17.0013C8.50182 12.3129 12.3108 8.49783 16.9993 8.49783C21.6878 8.49783 25.5028 12.3129 25.5028 17.0013C25.5028 21.6898 21.6878 25.4988 16.9993 25.4988C12.3108 25.4988 8.50182 21.6898 8.50182 17.0013ZM17.0501 13.2875C17.0367 13.2384 17.0222 13.192 17.0065 13.1482C16.8985 12.8456 16.7463 12.6097 16.5499 12.4406C16.383 12.2893 16.1768 12.178 15.9313 12.1068C15.6858 12.0356 15.401 12 15.0769 12C14.6841 12 14.3355 12.0312 14.0311 12.0935C13.9755 12.1032 13.9187 12.1141 13.8605 12.1263C13.5999 12.1805 13.3131 12.2586 13 12.3605L13.4998 13.5049L13.5597 13.6422C13.707 13.5888 13.8494 13.5487 13.9869 13.522C14.1342 13.4953 14.2717 13.482 14.3993 13.482C14.635 13.482 14.8118 13.522 14.9296 13.6021C15.0475 13.6733 15.126 13.7846 15.1653 13.9359C15.1894 14.0287 15.2061 14.1348 15.2154 14.2543C15.2213 14.3298 15.2242 14.4106 15.2242 14.4967V15.2977H14.3793H13.9869V16.7664H15.1375H15.2242V16.8482V17.3962V18.729V19.7704C15.2242 20.1442 15.2488 20.4424 15.2979 20.6649C15.3568 20.8874 15.4304 21.061 15.5188 21.1856C15.6114 21.303 15.7083 21.4086 15.8095 21.5023C15.8157 21.508 15.8219 21.5137 15.8282 21.5194C15.8482 21.5365 15.8691 21.5532 15.8907 21.5696C16.0438 21.6853 16.236 21.7816 16.4672 21.8587C16.4751 21.8613 16.483 21.8639 16.491 21.8665C16.7758 21.9555 17.1244 22 17.5368 22C17.9885 22 18.4501 21.9377 18.9214 21.8131C19.4026 21.6796 19.8445 21.4882 20.2471 21.239C20.6498 20.9898 20.9738 20.6782 21.2193 20.3044C21.4648 19.9306 21.5876 19.5033 21.5876 19.0227C21.5876 18.5154 21.4108 18.1415 21.0573 17.9012C20.8843 17.7836 20.6843 17.6948 20.4572 17.6347C20.2202 17.5721 19.9538 17.5407 19.6579 17.5407C19.4223 17.5407 19.1915 17.5496 18.9656 17.5674C18.7496 17.5852 18.5532 17.6164 18.3764 17.6609L18.6121 19.0227C18.7496 18.996 18.9067 18.9826 19.0835 18.9826C19.0858 18.9826 19.088 18.9826 19.0903 18.9827C19.3124 18.9834 19.4623 19.019 19.5401 19.0895C19.6187 19.1607 19.6579 19.2363 19.6579 19.3164C19.6579 19.4766 19.6039 19.6324 19.4959 19.7837C19.3879 19.935 19.2455 20.0685 19.0687 20.1842C18.892 20.2911 18.6956 20.3801 18.4795 20.4513C18.2635 20.5136 18.0426 20.5447 17.8167 20.5447C17.7902 20.5447 17.7646 20.5442 17.7399 20.5431C17.5309 20.534 17.3874 20.4863 17.3092 20.4001C17.3009 20.3909 17.2933 20.3813 17.2864 20.3712C17.2079 20.2465 17.1686 20.0596 17.1686 19.8104V17.5421V17.2349V16.7664H22V15.2977H17.1686V14.4299C17.1686 14.4239 17.1686 14.4179 17.1686 14.4119C17.1683 14.2884 17.1653 14.1712 17.1596 14.0603C17.1438 13.7549 17.1073 13.4973 17.0501 13.2875Z"
                                                    fill="#FF6006"></path>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Transaction</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-[40px] font-semibold text-[var(--color-chinese-black)]">৳ <?php echo $total_amount; ?></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0_1386_57685)">
                                                    <path
                                                        d="M9.70497 1.94258H24.0368L24.0389 6.96118L25.9405 9.01904V1.38232C25.9427 1.2021 25.9091 1.02324 25.8418 0.856046C25.7745 0.688849 25.6748 0.536619 25.5484 0.408129C25.4221 0.279638 25.2715 0.177425 25.1054 0.10738C24.9394 0.0373343 24.7611 0.0008402 24.5808 0L9.14579 0C8.38406 0 7.76562 0.620591 7.76562 1.38232V3.64705H9.70605L9.70497 1.94258Z"
                                                        fill="#008EFF"></path>
                                                    <path
                                                        d="M9.88295 7.41194H18.8697L18.8567 10.9448C18.8546 11.3337 19.0087 11.7022 19.2834 11.978C19.5581 12.2538 19.9245 12.4068 20.3123 12.4068H23.9378V21.0003H26.0571V12.659C26.0571 11.7227 25.6789 10.822 25.0152 10.1594L21.2023 6.3356C20.5371 5.67027 19.6349 5.2963 18.6941 5.2959H9.26667C8.43598 5.2959 7.76367 5.97359 7.76367 6.80213V20.9992H9.88187V7.41194H9.88295ZM20.9415 8.99467L22.2926 10.3307L20.9415 10.3285V8.99467Z"
                                                        fill="#008EFF"></path>
                                                    <path
                                                        d="M12.3453 11.8244H15.2263C15.7995 11.8244 16.2649 11.3384 16.2649 10.7642C16.2658 10.4865 16.1573 10.2197 15.9629 10.0215C15.7685 9.82329 15.5039 9.70961 15.2263 9.70508H12.3453C12.0679 9.70961 11.8034 9.82314 11.609 10.0211C11.4147 10.2191 11.306 10.4857 11.3066 10.7631C11.3066 11.3374 11.7721 11.8244 12.3453 11.8244ZM21.5281 13.7055H12.3463C12.2105 13.7047 12.0759 13.7306 11.9501 13.7819C11.8244 13.8332 11.7099 13.9088 11.6135 14.0044C11.517 14.1 11.4403 14.2137 11.3878 14.339C11.3354 14.4642 11.3081 14.5986 11.3077 14.7345C11.3077 15.3087 11.7732 15.7634 12.3463 15.7634H21.5281C21.6639 15.7644 21.7987 15.7385 21.9245 15.6873C22.0503 15.636 22.1648 15.5604 22.2613 15.4648C22.3578 15.3692 22.4345 15.2555 22.4869 15.1301C22.5393 15.0048 22.5664 14.8703 22.5667 14.7345C22.5663 14.5986 22.5391 14.4642 22.4866 14.339C22.4341 14.2137 22.3575 14.1 22.261 14.0044C22.1645 13.9088 22.0501 13.8332 21.9243 13.7819C21.7985 13.7306 21.6639 13.7047 21.5281 13.7055ZM21.5281 17.6467H12.3463C12.0693 17.6512 11.8052 17.7645 11.6109 17.962C11.4166 18.1595 11.3077 18.4255 11.3077 18.7026C11.3077 19.2758 11.7732 19.7617 12.3463 19.7617H21.5281C22.1002 19.7617 22.5667 19.2758 22.5667 18.7026C22.5667 18.4255 22.4579 18.1595 22.2636 17.962C22.0693 17.7645 21.8051 17.6512 21.5281 17.6467Z"
                                                        fill="#008EFF"></path>
                                                    <path
                                                        d="M27.4096 15.9893V20.0166L28.083 21.1167C28.1558 21.2336 28.196 21.368 28.1992 21.5057C28.2025 21.6435 28.1687 21.7796 28.1015 21.8998C28.0343 22.0201 27.936 22.1201 27.817 22.1895C27.6979 22.2589 27.5625 22.2951 27.4247 22.2943H6.53791C6.40076 22.2942 6.26608 22.2578 6.1476 22.1887C6.02912 22.1196 5.93107 22.0204 5.86345 21.901C5.79622 21.7809 5.76219 21.645 5.76484 21.5074C5.76749 21.3697 5.80673 21.2352 5.87853 21.1178L6.41293 20.2429V16.2155L3.29812 21.2578C2.87353 21.9444 2.64857 22.7357 2.64844 23.543V31.253C2.64872 31.982 2.93853 32.6811 3.45415 33.1965C3.96976 33.712 4.66896 34.0015 5.398 34.0015H28.6034C29.3321 34.0009 30.0309 33.7112 30.5462 33.1958C31.0615 32.6805 31.3513 31.9818 31.3519 31.253V23.5419C31.3519 22.7263 31.1224 21.928 30.6893 21.2352L27.4096 15.9893Z"
                                                        fill="#008EFF"></path>
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_1386_57685">
                                                        <rect width="34" height="34" fill="white"></rect>
                                                    </clipPath>
                                                </defs>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Stored Document</p>
                                    </div>
                                    <div class="mt-[20px] flex justify-between">
                                        <div>
                                            <p class="text-[40px] font-semibold text-[var(--color-chinese-black)]">0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="rounded-lg bg-white p-2">
                                    <div class="flex items-center justify-start gap-[16px]">
                                        <div class="rounded-[10px] bg-[var(--color-alice-blue)] p-[8px]"><svg width="34"
                                                height="34" viewBox="0 0 34 34" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <g clip-path="url(#clip0_1386_57783)">
                                                    <path
                                                        d="M27.0273 23.707C24.9219 23.707 23.209 21.9941 23.209 19.8887C23.209 17.7832 24.9219 16.0703 27.0273 16.0703C29.1328 16.0703 30.8457 17.7832 30.8457 19.8887C30.8457 21.9941 29.1328 23.707 27.0273 23.707ZM6.97266 23.707C4.86718 23.707 3.1543 21.9941 3.1543 19.8887C3.1543 17.7832 4.86718 16.0703 6.97266 16.0703C9.07813 16.0703 10.791 17.7832 10.791 19.8887C10.791 21.9941 9.07813 23.707 6.97266 23.707ZM23.6406 2.65625C22.3819 2.65625 21.2503 1.95686 20.6874 0.831141L20.5472 0.550707C20.4645 0.385229 20.3373 0.246058 20.18 0.148789C20.0226 0.0515213 19.8413 1.20952e-07 19.6562 5.32025e-10L14.3438 5.32026e-10C14.1588 -6.04468e-06 13.9774 0.0515052 13.82 0.148761C13.6627 0.246017 13.5355 0.385175 13.4528 0.550641L13.3126 0.831008C12.7497 1.95686 11.6181 2.65625 10.3594 2.65625C9.80927 2.65625 9.36328 3.10223 9.36328 3.65234V9.33652C9.36328 11.5714 10.0684 13.7004 11.4025 15.4934C12.7365 17.2864 14.5732 18.5736 16.7138 19.2158C16.9005 19.2718 17.0995 19.2718 17.2862 19.2158C19.4268 18.5736 21.2635 17.2864 22.5975 15.4934C23.9316 13.7004 24.6367 11.5714 24.6367 9.33652V3.65234C24.6367 3.10223 24.1907 2.65625 23.6406 2.65625ZM20.5217 8.45498L16.7653 12.2114C16.5707 12.4059 16.3158 12.5032 16.0609 12.5032C15.8061 12.5032 15.5511 12.406 15.3566 12.2114L13.4784 10.3332C13.0894 9.9442 13.0894 9.31354 13.4784 8.92454C13.8674 8.53553 14.4981 8.53553 14.8871 8.92454L16.061 10.0984L19.1132 7.0463C19.5021 6.65729 20.1328 6.65729 20.5219 7.0463C20.9107 7.43531 20.9107 8.06597 20.5217 8.45498ZM31.1007 24.028C30.0513 25.0609 28.6126 25.6992 27.0273 25.6992C25.4396 25.6992 23.9988 25.0589 22.9489 24.0231C22.3913 24.4245 21.8959 24.9062 21.479 25.4524L22.0263 25.9318C23.6852 27.3848 24.6367 29.4784 24.6367 31.6758V34H33.0039C33.554 34 34 33.554 34 33.0039V29.6836C34 27.3583 32.8556 25.2955 31.1007 24.028ZM2.8993 24.028C1.14438 25.2955 0 27.3583 0 29.6836V33.0039C0 33.554 0.445984 34 0.996094 34H9.36328V31.6758C9.36328 29.4784 10.3147 27.3848 11.9737 25.9318L12.521 25.4524C12.1041 24.9062 11.6087 24.4245 11.0511 24.0231C10.0012 25.0589 8.56043 25.6992 6.97266 25.6992C5.38741 25.6992 3.94871 25.0609 2.8993 24.028ZM20.7137 27.4304C19.7763 28.4086 18.4585 29.0195 17 29.0195C15.5415 29.0195 14.2237 28.4086 13.2863 27.4304C12.1041 28.4658 11.3555 29.9845 11.3555 31.6758V34H22.6445V31.6758C22.6445 29.9845 21.8959 28.4658 20.7137 27.4304ZM17 27.0273C15.2607 27.0273 13.8457 25.6124 13.8457 23.873C13.8457 22.1337 15.2607 20.7188 17 20.7188C18.7393 20.7188 20.1543 22.1337 20.1543 23.873C20.1543 25.6124 18.7393 27.0273 17 27.0273Z"
                                                        fill="#1440B0"></path>
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_1386_57783">
                                                        <rect width="34" height="34" fill="white"></rect>
                                                    </clipPath>
                                                </defs>
                                            </svg></div>
                                        <p class="text-[var(--color-dark-slate-blue)]">Total Family Member</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-[40px] font-semibold text-[var(--color-persian-blue)]">1</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="applied-visa-cards">
                                <div class="mb-[15px] flex justify-between">
                                    <p class="text-[18px] font-medium text-[var(--color-chinese-black)]">Current
                                        Application Status</p><a class="inline-block custom_link"
                                        href="/user/applied-visa/"><button type="button"
                                            class="ant-btn css-1588u1j ant-btn-default border-none text-[var(--color-primary)] shadow-none"><span>View
                                                All</span></button></a>
                                </div>
                                <div class="applied_visa">
    <div class="applied_visa_list">
        <div class="ant-row ant-row-center css-1588u1j" style="margin-left:-10px;margin-right:-10px;row-gap:20px">
            <?php if ($entries_unpaid_visa): ?>
                <?php $display_count = 0;
                foreach ($entries_unpaid_visa as $entry): if ($display_count >= 4) break; // Stop after 4 entries?>
                    <div class="ant-ribbon-wrapper css-1588u1j">
                        <div class="applied_visa_card">
                            <div class="title">
                                <p>Applied for Afghanistan Family Visit form Bangladesh</p>
                            </div>
                            <div class="content">
                                <div class="id">
                                    <p class="text-[var(--text-color)]">- - Not Initiated - -</p>
                                    <p class="mt-1 text-xs 2xl:text-[16px]"><?php echo esc_html($entry->date_modified); ?></p>
                                </div>
                                <div class="separator"></div>
                                <div class="case_processing_not_start w-full max-w-[750px]">
                                    <div class="ant-steps ant-steps-horizontal css-1588u1j ant-steps-default ant-steps-label-vertical ant-steps-dot">
                                        <div class="ant-steps-item ant-steps-item-process ant-steps-item-active">
                                            <div class="ant-steps-item-container">
                                                <div class="ant-steps-item-tail"></div>
                                                <div class="ant-steps-item-icon">
                                                    <span class="ant-steps-icon"><span class="ant-steps-icon-dot"></span></span>
                                                </div>
                                                <div class="ant-steps-item-content">
                                                    <div class="ant-steps-item-title">Payment</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ant-steps-item ant-steps-item-wait">
                                            <div class="ant-steps-item-container">
                                                <div class="ant-steps-item-tail"></div>
                                                <div class="ant-steps-item-icon">
                                                    <span class="ant-steps-icon"><span class="ant-steps-icon-dot"></span></span>
                                                </div>
                                                <div class="ant-steps-item-content">
                                                    <div class="ant-steps-item-title">Applicant Profile</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ant-steps-item ant-steps-item-wait">
                                            <div class="ant-steps-item-container">
                                                <div class="ant-steps-item-tail"></div>
                                                <div class="ant-steps-item-icon">
                                                    <span class="ant-steps-icon"><span class="ant-steps-icon-dot"></span></span>
                                                </div>
                                                <div class="ant-steps-item-content">
                                                    <div class="ant-steps-item-title">Checklist</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ant-steps-item ant-steps-item-wait">
                                            <div class="ant-steps-item-container">
                                                <div class="ant-steps-item-tail"></div>
                                                <div class="ant-steps-item-icon">
                                                    <span class="ant-steps-icon"><span class="ant-steps-icon-dot"></span></span>
                                                </div>
                                                <div class="ant-steps-item-content">
                                                    <div class="ant-steps-item-title">Documents</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ant-steps-item ant-steps-item-wait">
                                            <div class="ant-steps-item-container">
                                                <div class="ant-steps-item-tail"></div>
                                                <div class="ant-steps-item-icon">
                                                    <span class="ant-steps-icon"><span class="ant-steps-icon-dot"></span></span>
                                                </div>
                                                <div class="ant-steps-item-content">
                                                    <div class="ant-steps-item-title">Review & Submission</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="separator"></div>
                                <div class="ant-space css-1588u1j ant-space-vertical 2xl:mr-[90px]" style="gap: 16px;">
                                    <div class="ant-space-item">
                                        <a href="/<?php echo $atts["form_submit_page"] ?>/?entry_id=<?php echo esc_attr($entry->entry_id); ?>" target="_blank" class="ant-btn css-1588u1j ant-btn-primary ant-btn-lg w-full">
                                            <span>Continue Payment</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ant-ribbon ant-ribbon-placement-end css-1588u1j">
                            <span class="ant-ribbon-text">WEB</span>
                            <div class="ant-ribbon-corner"></div>
                        </div>
                    </div>
                <?php $display_count++; endforeach; ?>
            <?php else: ?>
                <p>No unpaid visa applications found.</p>
            <?php endif; ?>
        </div>
    </div>
</div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </main>
    </div>
    <script id="__NEXT_DATA__"
        type="application/json">{"props":{"pageProps":{}},"page":"/user","query":{},"buildId":"9fmPZqRL0NhrU0EXE1c_j","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script>
    
    <script id="google-analytics-script" data-nscript="afterInteractive">window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-EBPQ33J7JL');</script>
    <script id="fb-pixel" data-nscript="afterInteractive">!function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0';
            n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '761961522774595');
        fbq('track', 'PageView');</script>
        <p aria-live="assertive" id="__next-route-announcer__" role="alert"
            style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; top: 0px; width: 1px; white-space: nowrap; overflow-wrap: normal;">
        </p>
    </next-route-announcer><iframe id="_hjSafeContext_78308674" title="_hjSafeContext" tabindex="-1" aria-hidden="true"
        src="about:blank"
        style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe>
    <div id="veepn-guard-alert"></div>
    <style>
        @font-face {
            font-family: FigtreeVF;
            src: url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2 supports variations"), url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2-variations");
            font-weight: 100 1000;
            font-display: swap
        }
    </style>
    <div id="veepn-breach-alert"></div>
    <style>
        @font-face {
            font-family: FigtreeVF;
            src: url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2 supports variations"), url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2-variations");
            font-weight: 100 1000;
            font-display: swap
        }
    </style>
</body>
    <?php

    return ob_get_clean();
    // }
}

add_shortcode('visa_dashboard', 'visa_dashboard_shortcode');

include_once 'profile.php';
include_once 'my-applied-visa.php';
include_once 'prefill-form.php';
include_once 'transactions.php';
include_once 'co-travelers.php';
include_once 'documents.php';
include_once 'appointment.php';
include_once 'checklist.php';
include_once 'setting.php';
include_once 'get_cities.php';
// Create a page with the shortcode
function visa_dashboard_create_page() {
    $page_title = 'User'; // Ensure the title matches your requirements
    $page_content = '[visa_dashboard]'; // Shortcode to be executed
    $page_check = get_page_by_title($page_title);
    
    if (!isset($page_check->ID)) {
        $new_page_id = wp_insert_post(array(
            'post_title' => $page_title,
            'post_content' => $page_content,
            'post_status' => 'publish',
            'post_type' => 'page',
        ));
    }
}

// Hook into the plugin activation
register_activation_hook(__FILE__, 'visa_dashboard_create_page');


// create database table
function create_user_info_table() {
    global $wpdb;

    // Define the table names
    $user_info_table = $wpdb->prefix . 'user_info';
    $passport_info_table = $wpdb->prefix . 'passport_info';
    $spouse_info_table = $wpdb->prefix . 'spouse_info';
    $parents_info_table = $wpdb->prefix . 'parents_info';
    $siblings_info_table = $wpdb->prefix . 'siblings_info';
    $children_info_table = $wpdb->prefix . 'children_info';
    $occupation_info_table = $wpdb->prefix . 'occupation_info';
    $professional_contact_info_table = $wpdb->prefix . 'professional_contact_info';
    $travel_history_info_table = $wpdb->prefix . 'travel_history_info';
    $other_info_table = $wpdb->prefix . 'other_info';
    $co_travelers_info_table = $wpdb->prefix . 'co_travelers_info';

    // SQL to create tables
    $charset_collate = $wpdb->get_charset_collate();

    // Create user info table
    $sql1 = "
    CREATE TABLE IF NOT EXISTS $user_info_table (
        user_id INT AUTO_INCREMENT PRIMARY KEY,
        nid_no VARCHAR(255),
        nid_address VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;
    ";
    // Execute the SQL query
    require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
    dbDelta($sql1);

    // Create passport info table
    $sql2 = "
    CREATE TABLE IF NOT EXISTS $passport_info_table (
        passport_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        given_name VARCHAR(255),
        surname VARCHAR(255),
        country_code VARCHAR(10),
        nationality VARCHAR(255),
        date_of_birth DATE,
        issue_date DATE,
        expiry_date DATE,
        passport_number VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;
    ";
    dbDelta($sql2);

    $sql3 = "CREATE TABLE IF NOT EXISTS $spouse_info_table (
        spouse_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        name VARCHAR(255),
        date_of_birth DATE,
        date_of_marriage DATE,
        place_of_marriage VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql3);


    $sql4 = "CREATE TABLE IF NOT EXISTS $parents_info_table (
        parent_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        father_name VARCHAR(255),
        father_date_of_birth DATE,
        father_date_of_death DATE,
        father_address VARCHAR(255),
        mother_name VARCHAR(255),
        mother_date_of_birth DATE,
        mother_date_of_death DATE,
        mother_address VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql4);

    $sql5 = "CREATE TABLE IF NOT EXISTS $siblings_info_table (
        sibling_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        relationship VARCHAR(50),
        name VARCHAR(255),
        date_of_birth DATE,
        present_address VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql5);

    $sql6 = "CREATE TABLE IF NOT EXISTS $children_info_table (
        child_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        name VARCHAR(255),
        date_of_birth DATE,
        present_address VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql6);

    $sql7 = "CREATE TABLE IF NOT EXISTS $occupation_info_table (
        occupation_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        company_name VARCHAR(255),
        type_of_company VARCHAR(255),
        business_sector VARCHAR(255),
        company_address VARCHAR(255),
        designation VARCHAR(255),
        joining_date DATE,
        company_start_date DATE,
        responsibilities TEXT,
        company_email VARCHAR(255),
        company_phone VARCHAR(50),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";
    dbDelta($sql7);

    $sql8 = "CREATE TABLE IF NOT EXISTS $professional_contact_info_table (
        contact_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        name VARCHAR(255),
        email VARCHAR(255),
        phone_number VARCHAR(50),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";
    dbDelta($sql8);

    $sql9 = "CREATE TABLE IF NOT EXISTS $travel_history_info_table (
        travel_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        from_country VARCHAR(255),
        to_country VARCHAR(255),
        from_city VARCHAR(255),
        to_city VARCHAR(255),
        purpose VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql9);

    $sql10 = "CREATE TABLE IF NOT EXISTS $other_info_table (
        info_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        others_info TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;";

    dbDelta($sql10);

    $sql11 = "CREATE TABLE IF NOT EXISTS $co_travelers_info_table (
        co_traveler_id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT,
        first_name VARCHAR(255),
        last_name VARCHAR(255),
        email VARCHAR(255),
        phone_number VARCHAR(50),
        relationship VARCHAR(50),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    ) $charset_collate;
    ";

    dbDelta($sql11);  
}

register_activation_hook(__FILE__, 'create_user_info_table');


// AJAX handler for nid info form submission
function handle_form_submission() {
    global $wpdb;

    // Optional: Check nonce for security
    // check_ajax_referer('your_nonce_action', 'nonce');

    $nid = sanitize_text_field($_POST['nid']);
    $address = sanitize_textarea_field($_POST['address']);
    $user_id = sanitize_textarea_field($_POST['user_id']);

    // Check if record exists for the user
    $table_name = $wpdb->prefix . 'user_info';
    $existing_entry = $wpdb->get_row($wpdb->prepare("SELECT * FROM $table_name WHERE user_id = %d", $user_id));

    if ($existing_entry) {
        // Update the existing entry
        $wpdb->update($table_name, array(
            'nid_no' => $nid,
            'nid_address' => $address
        ), array('user_id' => $user_id));

        wp_send_json_success('Data updated successfully.');
    } else {
        // Insert a new entry
        $wpdb->insert($table_name, array(
            'user_id' => $user_id,
            'nid_no' => $nid,
            'nid_address' => $address
        ));

        wp_send_json_success('Data saved successfully.');
    }
}

add_action('wp_ajax_save_user_info', 'handle_form_submission');
add_action('wp_ajax_nopriv_save_user_info', 'handle_form_submission');



// subscriber only able to access user dashboard
add_action('after_setup_theme', function() {
    if (current_user_can('subscriber')) {
        // Hide the admin bar
        add_filter('show_admin_bar', '__return_false');
    }
});

add_action('admin_init', function() {
    if (current_user_can('subscriber')) {
        // Redirect subscribers trying to access wp-admin
        wp_redirect(home_url('/user/')); // Replace '/user/' with your desired URL
        exit;
    }
});

